{% extends 'account/account.html' %}
{% block headertitle %}<title>VetCove | Payment</title>{% endblock%}
{% block payment %}active{% endblock %}

{% block jsblock %}
<script src="{{STATIC_URL}}js/maskedinput.js" type="text/javascript" ></script>
<script>
var x_mark_src = "{{STATIC_URL}}img/xmark.png";
var check_mark_src = "{{STATIC_URL}}img/checkmark.png";
var blank_src = "{{STATIC_URL}}img/blank.png";
var loading_src = "{{STATIC_URL}}img/ajax-loader2.gif";
</script>
<script type="text/javascript" src="{{STATIC_URL}}js/address.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/balanced.js"></script>
<script type="text/javascript">
var marketplaceUri = '/v1/marketplaces/TEST-MP49EIrAntwbE1iYZDuZWtjo';
//BALANCED_CC GLOBAL VARIABLES
var responseTarget_cc = "/account/addcreditcard";
var success_redirect_cc = "/account/payment";
var balanced_cc_button_text = "Add This Card";
//BALANCED_BA GLOBAL VARIABLES
var responseTarget_ba = '/account/addbankaccount';
var success_redirect_ba = "/account/payment";
var balanced_ba_button_text = "Add Bank Account";
</script>
<script type="text/javascript" src="{{STATIC_URL}}js/balanced_cc.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}js/balanced_ba.js"></script>
<script>
//Functionality of payment method 
$(document).ready(function() {
	
	//Toggle displays of the two payout methods, credit card
	$(".button-payment").click(function() {
		$(".button-payment").removeClass('button-payment-glow');
		$(".button-payment").removeClass('button-primary');
		if (!($(this).hasClass('payment-button-glow'))) {
			$(this).addClass('payment-button-glow');
		};
		if (!($(this).hasClass('button-primary'))) {
			$(this).addClass('button-primary');
		};
		$(".payment-add").css('display','none');
		if ($(this).attr('id') == "newbankaccount-button") {
			$(".payment-ba").css('display','block');
		} else if ($(this).attr('id') == "newcreditcard-button") {
			$(".payment-cc").css('display','block');
		} 
	});
	$(".payment-cancel").click(function() {
		$(".button-payment").removeClass('button-payment-glow');
		$(".button-payment").removeClass('button-primary');
		$(".payment-add").css('display','none');
	});
	$(".address-cancel").click(function() {
		$(".payment-address-new-form").css('display','none');
		$(".payment-address-div").css('display','block');
		$(".payment-address-new-button").css('display','block');
	});
	$(".payment-address-new-button button").click(function() {
		$(".payment-address-new-button").css('display','none');
		$(".payment-address-div").css('display','none');
		$(".payment-address-new-form").css('display','block');
	});
	
	$('.mailchecks').prop('checked',{% if user.basicuser.payout_method == 'check' %}true{%else%}false{% endif %});
	$('.mailchecks').click(function() {
		if ($(this).is(':checked')) {
			$('#payment-address-container').css('display','block');
			console.log('asol');
		} else {
			$('#payment-address-container').css('display','none');
		}
	});
});
</script>
{% endblock %}
{% block maintitle %}Payment{% endblock %}
{% block headersubcss %}
<link href="{{STATIC_URL}}css/checkoutform.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/cc_form.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/payment_methods.css" rel="stylesheet" type="text/css" />

<style>
.maincontent-title {
	color: #888;
	letter-spacing: .5px;
	font-weight: 800;
	background: #f2f2f2;
	border-bottom:1px solid #ddd;
	margin: 0;
	line-height: 32px;
	padding: 10px 0px 0px 20px;
	margin-bottom: 0px;
	background-image: -ms-linear-gradient(top, #FFFFFF 0%, #EEEEEE 100%);
	background-image: -moz-linear-gradient(top, #FFFFFF 0%, #EEEEEE 100%);
	background-image: -o-linear-gradient(top, #FFFFFF 0%, #EEEEEE 100%);
	background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #FFFFFF), color-stop(1, #EEEEEE));
	background-image: -webkit-linear-gradient(top, #FFFFFF 0%, #EEEEEE 100%);
	background-image: linear-gradient(to bottom, #FFFFFF 0%, #EEEEEE 100%);
}

.paymentbox-container {
	margin-bottom: 15px;
}
.paymentbox {
	padding: 0px 30px 0 30px;
}
.paymentbox div {
	padding-left: 0;
	padding-right: 0;
}

/* Current payment formatting */
.paymentbox .payment-current {
	padding: 10px 0px 10px 0px;
}
.paymentbox .payment-current h5 {
	margin-top: 20px;
}
.paymentbox .payment-current p {
	font-weight: 200;
	padding-bottom: 0;
	margin: 0;
	font-size: 13px;
}

/* New payment buttons */
.paymentbox .payment-new {
	border-top: 1px solid #ddd;
	margin-bottom: 20px;
	padding: 20px 0 0 0;
}
.paymentbox .payment-new .button-payment-glow {
	box-shadow: 0 0 5px #00B5E5;
}

/* Credit card and bank account add */
.paymentbox .payment-add {
	margin: 10px 0px 20px 0px;
	display: none;
}
.paymentbox .payment-add table {
	width: 100%;
	max-width: 500px;
}
.paymentbox .payment-add .explain {
	margin: 0;
}
.paymentbox .payment-add .payment-cancel-a {
	margin-top: 15px;
}
.paymentbox .payment-add .payment-cancel:hover {
	cursor: pointer;
}


/* Supplementary cc form formatting */
.cc_form .form-group {	
	margin-bottom: 15px;
}
.cc_form .expiration-row div {
	padding-bottom: 0;
}

/* Formatting when submitting new bank account */
#ba-submit img {
	display: none;
}

/* Error formatting */
.div-error{
	margin-top: 30px;
}
.error-format {
	display: none;
	text-align: center;
	margin-left: 0;
	margin-right: 0;
}

.payment-actions {
	margin-left: 15px;
	text-align: right;
}
.payment-actions form {
	display: inline-block;
}

/*Payment Address formatting*/

.paymentbox .payment-address {
}
.paymentbox .payment-address .address-toggle {
	margin: 10px 0;
	margin-left: 20px;
}
.paymentbox .payment-address .checkbox label {
	font-weight: 200;
	font-size: 13px;
}
.paymentbox .payment-address-div div {
	padding: 15px 3px;
}
.paymentbox .address-box {
	padding: 10px 0 20px 0;
	border:1px solid #ddd;
	border-radius: 3px;
	background: #f6f6f6;
	text-align: center;	
}
.paymentbox .address-box form {
	display: inline-block;
}

.paymentbox .address-box button {
	margin-top: 15px;
}
.paymentbox .address-box p {
	margin: 0;
	font-size: 13px;
	text-align: center;
	font-weight: 500;
	padding: 0;
}
.payment-address-new-button {
	margin-top: 10px;
	margin-bottom: 10px;
}
.payment-address-new-button div {
	padding: 0;
	padding-left: 3px;
}
.payment-address-new-form {
	border:1px solid #ddd;
	border-radius: 4px;
	padding: 20px;
	background: #f6f6f6;
	display: none;
}
.paymentbox .payment-address-new-form .address-description {
	padding: 0 20px;
	margin-bottom: 20px;
}
.payment-address-new-form .addressform {
	padding: 0 20px;
}
.payment-address-new-form .addressform table{
	width: 100%;
	max-width: 400px;
}
.payment-address-new-form .addressform .form-img {
	width: 50px;
}
.payment-address-new-form .addressform .form-img img{
	max-width: 20px;
	margin-left: 10px;
}
.hide-div {
	display: none;
}
</style>
{% endblock %}
{% block maincontent %}
	<div class="covebox paymentbox-container">
		<h4 class="maincontent-title">Paying Out and Receiving Payments<img class="balanced-image" src="{{STATIC_URL}}img/balanced-image.png"/></h4>
		<div class="paymentbox">
			<div class="payment-current">
				<h5>Paying for Items and Paying Seller Commission</h5>
				<p>For sellers, the commission payment account is used to assess commission on items that
				are sold offline (For online sales, the commission is deducted from the credit). When purchasing
				items, you will always have the choice which payment method to use.</p>	
				<h5>Receiving Payment</h5>
				<p>When you sell an item, you can either have your bank account credited, or we can mail you a
				check monthly. </p>
				<div class="payment-address">	
					<form class="address-toggle">
						<div class="checkbox">
							<label>
								<input class="mailchecks" type="checkbox" {% if user.basicuser.payout_method == 'check' %}checked{% endif %}> I'd rather receive payments from sales via check by mail
							</label>
						</div>
					</form>	
					<div id="payment-address-container" class="{% if user.basicuser.payout_method != 'check' %}hide-div{% endif %}">
						<div class="payment-address-div row">
							{% for address in user.basicuser.useraddress_set.all %}
							<div class="col-md-6 col-sm-6 col-xs-12">
								<div class="address-box">
									<p>{{address.name}}</p>
									<p>{{address.address_one}}</p>
									<p>{{address.address_two}}</p>
									<p>{{address.city}}, {{address.state}} {{address.zipcode}}</p>
									<p>{{address.phonenumber}}</p>
									{% if user.basicuser.check_address == address and user.basicuser.payout_method == 'check'%}
									<button class="button button-tiny button-rounded button-highlight">Current Mailing Address</button>
									{% else %}
									<form action="/account/setmailingaddress/{{address.id}}" method="POST">
										{% csrf_token %}
										<button class="button button-tiny button-rounded">Set as Mailing Address</button>
									</form>
									{% endif %}
									<form action="/account/deletemailingaddress/{{address.id}}" method="POST">
										{% csrf_token %}
										<button class="button button-tiny button-rounded">Delete Address</button>
									</form>
								</div>
							</div>
							{% endfor %}
						</div>
						<div class="row payment-address-new-button">
							<div class="col-md-12 col-sm-12 col-xs-12">
								<button class="button button-tiny button-rounded">{% if user.basicuser.useraddress_set.all %}or {% endif %}Enter a New Mailing Address</button>
							</div>
						</div>
						<div class="row payment-address-new-form">
							<p class="address-description">Enter a new mailing address to receive checks from sales on VetCove</p>
							{% include 'general/address.html' %}
						</div>
					</div>
				</div>
			</div>
			<div class="payment-cards">
				<h5>Current Cards and Bank Accounts</h5>
				{% include 'account/payment_methods.html' %}
			</div>
			<div class='payment-new'>
				<button id="newcreditcard-button" class="button button-rounded button-payment button-cc-payment">Add a New Credit Card</button> 
				<button id="newbankaccount-button" class="button button-rounded button-payment button-ba-payment">Add a New Bank Account</button> 
			</div>
			<div class="payment-add checkoutform-container payment-cc">
				<p class="explain">Sellers getting paid through direct deposit to a bank account are paid every Monday at 5pm after a minimum 14 days after the sale.</p>
				<button class="populate">Populate</button>
				{% include 'account/cc_form.html' %}
			</div>
			<div class="payment-add checkoutform-container payment-ba">
				<p class="explain">Please check your bank websites for the routing number used specifically for ACH or electronic deposits. Some large banks, particularly Bank Of America, may have different routing numbers for checks and direct deposits.
				Note that wire transfer numbers are NOT the same as the routing number, and they are NOT the same as the bank account number.
				Payments might be delayed by up to (3) three to (5) five business days if incorrect information is provided</p>
				{% include 'account/ba_form.html' %}
				
			</div>
		</div> <!-- end paymentbox -->
	</div>
  		
{% endblock %}