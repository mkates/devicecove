{% extends 'base.html' %}
{% block headertitle %}<title>{{item.name}}</title>{% endblock%}
{% block headercss %}
<link href="{{STATIC_URL}}css/base.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}css/elastislide.css" />
<link href="{{STATIC_URL}}css/productitem.css" rel="stylesheet" type="text/css" />
<link href="{{STATIC_URL}}css/product.css" rel="stylesheet" type="text/css" />
<style>
#saveloader {
	display: none;
}
.actionbox .item-sold {
	font-size: 20px;
	padding: 10px;
	font-weight: 800;
	color: red;
}
</style>
{% endblock%}


{% block content %}

{% block productmain %}

{% endblock %}
{%endblock %}
{% block jsblock %}
<script src="http://malsup.github.com/jquery.form.js"></script> 
<script src="{{STATIC_URL}}js/elastislide/modernizr.custom.17475.js"></script> 
<script src="{{STATIC_URL}}js/elastislide/jquery.elastislide.js"></script> 
<script src="{{STATIC_URL}}js/elastislide/jquerypp.custom.js"></script> 
<script>
$(document).ready(function() {	
	$( '#carouselrelated' ).elastislide( {
		minItems : 3
	});
});
var loggedIn = {% if user.is_authenticated %}true{% else %}false{% endif %};
$(document).ready(function(){
	$(".thumbnail-container img").click(function() {
		$("#ex1").css("background-image",'url('+$(this).attr("data-original")+')');
		console.log($("#mainimage").css("width"));
	});
	$(".backbutton").click(function() {
		if (document.referrer.split('/').indexOf('productsearch') >= 0) {
			history.back();
		} else {
			window.location = "/productsearch/veterinary/{{item.subcategory.maincategory.name}}/{{item.subcategory.name}}"
		}
	
	});
});
$(document).ready(function() {
	//Save Button Functionality
	$('#save').click(function() {
		if ($(this).text() == 'Add to Wishlist') {
			var data = {'action':'save','id':{{item.id}}};
			var action = 'save';
		} else {
			var data = {'action':'delete','id':{{item.id}}};
			var action = 'delete'
		}
		$(this).html('<img class="saveloader" src="{{STATIC_URL}}img/ajax-loader.gif"/>');
		savebutton = $(this);
		savebutton.prop("disabled",true);
		$.ajax({
            type : "POST",
            data : data,
            url : "/saveitem",
            success : function(data) {
            	if (data['status'] != '400'){
					savebutton.css('display','inline-block');
					if (action == "save") {
						savebutton.html("Added to Wishlist");
						savebutton.addClass("button-royal");
					} else {
						savebutton.html("Add to Wishlist");
						savebutton.removeClass("button-royal");
					}
					savebutton.prop("disabled",false);
				} else {
					window.location.href = data['redirect'];
				}
            }, 
            error : function(jqXHR, textStatus, errorThrown) {
                alert("Error saving product");
            }
        });
	});
	
	//Contact Seller Button
	$("#contactseller").click(function() {
		if (loggedIn) {
			$("#buynowcontainer").fadeIn('fast').css('display', 'table');
		} else {
			window.location.href= "/login?next=/item/{{item.id}}/details&action=contactseller";
		}
	});
	 $('#buynowcontainer').click(function (e) {
    		if (e.target.id == 'buynowbackalign') {
    			$('#buynowcontainer').fadeOut();
    		}
  	});
  	$(".closecontactseller").click(function() {
  		$('#buynowcontainer').fadeOut();
  	});
  	$('#messageseller').ajaxForm(function(e) {
  		if (e == 201) {
			$("#contactbox").css('display','none');
			$("#successbox .contact-error").css('display','none');
			$("#successbox").fadeIn();
		} else {
			$("#contactbox").css('display','none');
			$("#successbox .contact-success").css('display','none');
			$("#successbox").fadeIn();
		}
		
  	}); 
  	
  	//Ask Question
  	$(".askquestion").click(function() {
  		if (loggedIn) {
			$(this).addClass("askquestionactive");
			$("#newquestion").css('display','block');
		} else {
			window.location.href= "/login?next=/item/{{item.id}}/details&action=question";
		}
	});
	$(".askquestioncancel").click(function() {
		$(".askquestion").removeClass("askquestionactive");
		$("#newquestion").css('display','none');
	});
	//Ask Question
  	$(".deletequestion").click(function() {
  		var handle = $(this);
  		$.ajax({
            type : "POST",
            data : {'questionid':$(this).attr("data_questionid")},
            url : "/deletequestion",
            success : function(data) {
            	if (data == 400) {
            		$(handle.parent().parent()).remove();
            	}
            }, 
            error : function(jqXHR, textStatus, errorThrown) {
                alert("Error saving product");
            }
        });
	});
	$(".askquestioncancel").click(function() {
		$(".askquestion").removeClass("askquestionactive");
		$("#newquestion").css('display','none');
	});
});
</script>
{% block lightbox %}
{% endblock %}
{% endblock %}