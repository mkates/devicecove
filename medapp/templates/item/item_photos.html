{% extends 'item/item_base.html' %}
{% block headertitle %}<title>VetCove | Item Photos</title>{% endblock%}
{% block customcss %}
<style>
/********************/
/** File Uploader ***/
/********************/
.imagecontainer {
	margin: 40px 30px 0 30px;
}
#fileupload {
	width: 100%;
	height: 40px;
	border:2px solid blue;
}
#currentimages p {
	font-size: 15px;
	font-weight: 200;
	color: #999;
	text-align: center;
	padding: 20px;
	margin-top: 60px;
}
.fileinput-button {
  position: relative;
  overflow: hidden;
  float: left;
  margin: 5px 20px 10px 0px;
}
.fileinput-button {
	background: #efefef;
	color: #333;
	font-size: 13px;
	border:1px solid #ddd;
	transition: background .3s;
}
.fileinput-button:hover, .fileinput-button:active {
	background: #ddd;
	border:1px solid #ddd;
	color: #333;
}
.fileinput-button input {
  position: absolute;
  top: 0;
  right: 0;
  margin: 0;
  opacity: 0;
  -ms-filter: 'alpha(opacity=0)';
  font-size: 200px;
  direction: ltr;
  cursor: pointer;
}
#imageloadercontainer {
	padding-top: 10px;
	width: 100%;
}
#imageloadercontainer .progress {
	height: 20px;
	margin-bottom: 0;
	padding-bottom: 0;
	visibility:hidden;
}

/* Fixes for IE < 8 */
@media screen\9 {
  .fileinput-button input {
    filter: alpha(opacity=0);
    font-size: 100%;
    height: 100%;
  }
}
#imagepreview {
	border:1px dotted #ccc;
	min-height: 185px;
	overflow: scroll;
	text-align: center;
	padding: 5px;
}
#noimages {
	padding: 20px;
	margin-top: 50px;
	font-weight: 200;
}
.imagepreviewcontainer {
	width: 170px;
	height: 200px;
	margin: 10px 20px 20px 20px;
	text-align: center;
	position: relative;
	float: left;
	border:1px solid #ccc;
	box-shadow: 0 0 2px #aaa;
	border-radius: 2px;
	position:relative;
}
.imagepreviewborder {
	height: 158px;
	width: 168px;
	text-align: center;
	display: table;
	position: relative;
	clear:both;
	margin: 0 auto;
}
.imagepreviewcontainer .delete {
	margin: 0px;
	position:absolute;
	bottom: 0;
	color: white;
	font-weight: bold;
	font-size: 12px;
	line-height: 18px;
	text-align: center;
	display: block;
	width: 100%;
	height: 20px;
	background: #555;
	opacity: .8;
}	

.imagepreviewcontainer h6 {
	font-size: 12px;
	width: 100%;
	padding: 3px 5px;
	background: #eee;
	margin: 0px;
}
.imagepreviewcontainer h6:hover {
	background: #ddd;
	cursor: pointer;
}
.imagepreviewcontainer .main {
	background: #8FCF00;
	background: -moz-linear-gradient(center top , #8FCF00, #6B9C00) repeat scroll 0 0 #7DB500;
	background-image: -ms-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: -moz-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: -o-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #8FCF00), color-stop(1, #6B9C00));
	background-image: -webkit-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: linear-gradient(to bottom, #8FCF00 0%, #6B9C00 100%);
	color: white;
}
.imagepreviewcontainer .main:hover {
	background: #8FCF00;
	background: -moz-linear-gradient(center top , #8FCF00, #6B9C00) repeat scroll 0 0 #7DB500;
	background-image: -ms-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: -moz-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: -o-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: -webkit-gradient(linear, left top, left bottom, color-stop(0, #8FCF00), color-stop(1, #6B9C00));
	background-image: -webkit-linear-gradient(top, #8FCF00 0%, #6B9C00 100%);
	background-image: linear-gradient(to bottom, #8FCF00 0%, #6B9C00 100%);
}
.imagepreviewcontainer p:hover {
	cursor: pointer;
	background: black;
	opacity: 1;
}
.container {

	border:1px solid red;
}
.imagepreview {
	max-width: 168px;
	max-height: 158px;
	position:relative;
	z-index: 0;
	border:1px solid #ccc;
}
.error {
	font-weight: bold;
	color: red;
	display: none;
}
.tips {
	margin-bottom: 20px;
}
.tips h4 {
	font-size: 14px;
	font-weight: bold;
	color: #2397BA;
}
.tips p {
	font-size: 13px;
	font-weight: 200;
}
{% if item.image_set.all %}
#noimages {
	display: none;
}
{% endif %}
</style>
{% endblock %}
{% block photocontent %}
<div class="formcontent row">
	<div class="imagecontainer">
			<h5>Upload Images</h5>
		<div class="row tips">
			<div class="col-md-4 col-sm-4">
				<h4>Tip 1: Quality Images</h4>
				<p>Good images will help your product sell.  Be sure to take large, high-resolution photos using good lighting in PNG or JPEG format.</p>
			</div>
			<div class="col-md-4 col-sm-4">
				<h4>Tip 2: Multiple Shots</h4>
				<p>Be sure to take photos of your item from multiple angles.  It is a good idea to include photos of any accessories or items included in your sale as well.</p>
			</div>
			<div class="col-md-4 col-sm-4">
				<h4>Tip 3: Close Ups</h4>
				<p> If your listing describes any defects or aesthetic blemishes, please include close-up images so that buyers feel confident in their purchase.</p>
			</div>
		</div>
	
		<p class="error">Error. Please reload the page and try again </p>
		<span class="btn btn-success fileinput-button">
			<span>Select pictures to upload...</span>
			<form id="fileform" method="post" action="/imageupload/{{item.id}}">
				{% csrf_token %}
				<input id="fileupload" type="file" name="files" multiple accept="image/*">
			</form>
		</span>
		<div id="imageloadercontainer">
			<div class="progress progress-striped active">
			  <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
			  </div>
			</div>
		</div>
		<div class='clear'></div>
		<div id="imagepreview" class="itemview">
			{% if item.image_set.all %}
				{% for p in item.image_set.all %}
					<div class='imagepreviewcontainer' data-imageid='{{p.id}}'>{% if item.mainimage.id == p.id %}<h6 class="main">Main Photo</h6>{% else %}<h6>Make Main Photo</h6>{% endif %}<div class='imagepreviewborder'><img class='imagepreview' src='{{p.photo.url}}'/></div><p class='delete'>Delete Photo</p></div>
				{% endfor %}			
			{% endif %}
			<p id="noimages">Upload multiple photos at once choosing 'Select pictures to upload. . .' and selecting multiple photos at once. We only accept PNG and JPEG images smaller than 2MB </p>		
		</div>
	</div>
</div>

{% endblock %}
{% block customjs %}

<script>
var numberpics = {{item.image_set.count }};
var mainpicid = {% if item.mainimage %}{{item.mainimage.id}}{% else %}""{% endif %};
var pictureBinds = function pictureBinds() {
	$(".imagepreviewcontainer .delete").click(function() {
		var handler = $(this).parent();
		handler.css('opacity','.2');
		$.ajax({
            type : "POST",
            data : {'imageid':$(this).parent().attr('data-imageid')},
            url : "/deleteimage",
            success : function(data) {
            	handler.remove();
            	numberpics -= 1;
            	if (handler.attr("data-imageid") == mainpicid && numberpics > 0) {
					var newmain = $($(".imagepreviewcontainer ")[0]);
					newmain.children('h6').text('Make Main Photo');
					newmain.children('h6').addClass('main');
					setMainImage(newmain.attr('data-imageid'));
				}
				if (numberpics == 0) {
					$("#noimages").css('display','block');
				}
            }, 
            error : function(jqXHR, textStatus, errorThrown) {
                handler.css('opacity','1');
                $("#error").css("display","block");
            }
        });	
	});
	$(".imagepreviewcontainer h6").click(function() {
		var imageid = $(this).parent().attr("data-imageid");
		$(".imagepreviewcontainer h6").removeClass('main');
		$(".imagepreviewcontainer h6").text('Make Main Photo');
		$(this).addClass('main');
		$(this).text('Main Photo');
		setMainImage(imageid);
	});
}

function setMainImage(imageid) {
	$.ajax({
		type : "POST",
		data : {'mainimageid':imageid},
		url : "/setmainimage",
		success : function(data) {
			mainpicid = imageid;
		}, 
		error : function(jqXHR, textStatus, errorThrown) {
			$(".error").css("display","block");
		}
	});	
};

$(document).ready(function() {
	pictureBinds();
	$("#fileupload").change(function() { 
		$("#fileform").submit();
		$("#imageloadercontainer .progress").css("visibility","visible");
		$("#imageloadercontainer .progress-bar").animate({"width":"80%"},1000);
	});
	$('#fileform').ajaxForm(function(e) { 
		$("#imageloadercontainer .progress-bar").animate({"width":"100%"},400,function() {
			$("#imageloadercontainer .progress").css("visibility","hidden");
			$("#imageloadercontainer .progress-bar").animate({"width":"0%"},1);
		});
		 if (e=='error') {
		 	$(".error").text("Error saving your image");
		 	$(".error").css("display","block");
		 } else if (e=="filetype") {
		 	$(".error").text("We only accept JPEG or PNG pictures");
		 	$(".error").css("display","block");
		 } else if (e=="filesize") {
		 	$(".error").text("Images can only be a maximum of 2MB");
		 	$(".error").css("display","block");
		 } else if (e=="filecount") {
		 	$(".error").text("You can only have a maximum of 8 images");
		 	$(".error").css("display","block");
		 } else {
		 	$(".error").css("display","none");
			 $.each(e,function(index,value) {
				$("#noimages").css('display','none');
				if (numberpics > 0) {
					var main = '<h6>Make Main Photo</h6>';
				}
				else {
					var main= "<h6 class='main'>Main Photo</h6>";
					setMainImage(e[index][0]);
				}
				numberpics += 1;
				$("#imagepreview").append("<div data-imageid='"+e[index][0]+"' class='imagepreviewcontainer'>"+main+"<div class='imagepreviewborder'><img class='imagepreview' src='"+e[index][1]+"'/></div><p class='delete'>Delete Photo</p></div>");
			 });
			 $(".imagepreviewcontainer .delete").unbind('click');
			 $(".imagepreviewcontainer h6").unbind('click');
			 pictureBinds();
		}
	});
});

</script>
{% endblock %}

{% block nextpage %}/list/logistics/{{item.id}}{% endblock%}

{% block continuebutton %}<a id="saveandcontinue" href="/list/logistics/{{item.id}}" class="button button-rounded button-action">Save and Continue</a>{% endblock %}

{% block photosactive %}active{% endblock%}

{% block previouspage %}/list/details/{{item.id}}{% endblock%}

{% block formaction %}/savephotos{% endblock%}

{% block backdescription %}Details{% endblock%}

{% block hidesave %}{% endblock %}