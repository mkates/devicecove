{% extends 'base.html' %}
{% block headercss %}
<link href='{{STATIC_URL}}css/base.css' rel='stylesheet' type='text/css' />
<link href='{{STATIC_URL}}css/productitem.css' rel='stylesheet' type='text/css' />
<link href='{{STATIC_URL}}css/jquery-ui-1.10.3.custom.css' rel='stylesheet' type='text/css' />
<link href='{{STATIC_URL}}css/search.css' rel='stylesheet' type='text/css' />

<style>
.catlink {
	display: block;
	padding-left: 3px;
	padding-right: 5px;
	font-size: 13px;
}
label .floatright {
	float: right;
}
.catlink:hover {
	background: #eee;
	text-decoration: none;
}
.noresults {
	opacity: .9;
	max-width: 230px;
}
#noresults {
	text-align: center;
	margin: 10px auto;
	padding: 30px 40px;
	{% if items %}
	display: none;
	{% endif %}
}
#noresults p {
	font-size: 14px;
	font-weight: 200;
}
#noresults .noluck {
	font-size: 23px;
	font-weight: 200;
	padding-bottom: 15px;
}

</style>
{% endblock%}


{% block content %}
{% load humanize %}
<div class='row searchcontainer'>
  <!--Filter Container -->
  <div class='col-xs-12 col-sm-3 filtercontainer'>
  	<div class='filterbox'>
  		<div class='filter-category notopborder'>
			<h2>Other {{ind | title}} Categories</h2>
			{% for cat in categories %} 
				{% if cat.totalunits > -1 %} 			
					<a class="catlink {% if category.name == cat.name %} active{% endif %}" href="/productsearch/{{ind}}/{{cat.name}}">{{cat.displayname}} <span>{{cat.totalunits}}</span></a>
				{% endif %}
			{% endfor %}
			{% for cat in categorieshidden %}  			
				<a class="catlink" href="/productsearch/{{ind}}/{{cat.name}}">{{cat.displayname}}</a>
			{% endfor %}
		</div>
		<div id='pricecategory' class='filter-category'>
  			<h2>Price Range</h2>
  			<div id='price-slider-container'>
  				<p id='lowprice'>$<span>{{pricelow}}</span></p>
  				<p id='highprice'>$<span>{{pricehigh}}</span></p>
  				<div class='clear'></div>
  				<div id='price-range' class='light-gradient'></div>
  			</div>
  		</div>
  		<div class='filter-category'>
  			<h2>Condition</h2>
  			<div class='checkbox'>
				<input id='new' type='checkbox' name='check' value='new' checked='checked'>
				<label for='new'>New</label>
				<input id='refurbished' type='checkbox' name='check' value='refurbished' checked='checked'>
				<label for='refurbished'>Refurbished</label>
				<input id='preowned' type='checkbox' name='check' value='preowned' checked='checked'>
				<label for='preowned'>Pre-Owned</label>
			</div>
  		</div>
  		<!-- 
<div class='filter-category'>
  			<h2>Service Contract</h2>
  			<div class='checkbox'>
				<input id='check1_1' type='checkbox' name='check' value='check1_1' checked='checked'>
				<label for='check1_1'>Included<span class="floatright">$24,321</span></label>
				<input id='check2_1' type='checkbox' name='check' value='check2_1' checked='checked'>
				<label for='check2_1'>Optional<span class="floatright">$22,321</span></label>
				<input id='check3_1' type='checkbox' name='check' value='check3_1' checked='checked'>
				<label for='check3_1'>Not Included<span class="floatright">$18,321</span></label>
			</div>
  		</div>
 -->
  		<!-- 
<div class='filter-category'>
  			<h2>Manufacturers</h2>
  			<div class='checkbox'>
				{% for man in manufacturer %}
					<input id='{{man.name}}' type='checkbox' name='check' value='check1_1' checked='checked'>
					<label for='{{man.name}}'>{{man.name}}</label>
				{% endfor %}
			</div>
  		</div>
  		
 -->

  		<!-- 
<div id='milecategory' class='filter-category'>
  			<h2>Distance</h2>
  			<select class='form-control'>
  				<option>Any Miles</option>
  				<option>500 Miles</option>
  				<option>250 Miles</option>
  				<option>100 Miles</option>
  				<option>50 Miles</option>
  				<option>25 Miles</option>
  			</select>
  			<p>from</p>
  			<input class='form-control' placeholder='Zipcode' type='number' maxlength='5'/>
  		</div>
 -->
  		
  	</div>
  </div>
  
  <!--Results Container -->
  <div class='col-xs-12 col-sm-9 resultscontainer'>
  	<div id='loadingoverlay'>
  		<div id='loaderdiv'>
  			<h3> Filtering search results . . .</h3>
  			<img src='{{STATIC_URL}}img/ajax-loader2.gif'/>
  		</div>
  	</div>
  	<div class='resultsbox resultsnav'>
  		<div class='' id='resultsparameter'>
  		Searching for {{ searchquery }}
  		</div>
  		<div id='sortby'>
  			<p> Sort By: </p>
  			<select class='form-control'>
  				<option> Relevance </option>
  				<option> Price </option>
  				<option> Best Deal </option>
  				<option> Most Viewed</option>
  				<option> Newest</option>
  			</select>
  		</div>
  		<div id='numberofresults'>2038 Results</div>
  		<img class='viewtypeimg' src='{{STATIC_URL}}img/listview.png'/>
  		<p> View By Product </p>
  		<img class='viewtypeimg' src='{{STATIC_URL}}img/gridview.png'/>
  		<p> View By Seller </p>
  		<div class='clear'></div>
  	</div>
  	
  	<div class='resultsbox' id='resultsbody'>
  		{% for item in items %}
  			{% include 'productsearchitem.html' %}
  		{% endfor %}
		<div id="noresults" class="resultitem">
			<p class="noluck">Sorry, we can't find anything that matches your search</p>
			<img class="noresults" src="{{STATIC_URL}}img/saddog.jpg"/>
			<p>Try changing your filters, or call us with what you want and we will let you know when one becomes available!</p>
		</div>
  	</div>
  	<div id='showmorebutton' class='resultsbox'>
  		<p>Show More Results</p>
  		<img src='{{STATIC_URL}}img/ajax-loader.gif'/>
  	</div>
  </div>
  	
</div>
{% endblock %}

{% block jsblock %}
<script src='{{STATIC_URL}}js/jquery-ui-1.10.3.custom.min.js' type='text/javascript' ></script>
<script src='{{STATIC_URL}}js/searchbox.js' type='text/javascript' ></script>

<script>
//*********************************************
//Global variable dictionary ******************
//*********************************************
var variables = {'category':'{{category.name}}','sortby':'relevance','pricelow':0,'pricehigh':10000000,'new':true,'refurbished':true,'preowned':true};

//*********************************************
//*** Miscellaneous Page Functions ************
//*********************************************
$(document).ready(function(){
	activateResultsBoxItems();
	$('input').prop('checked', true);
	$("input").change(function() {
		var checkboxname = $(this).attr('id');
		variables[checkboxname] = ($(this).is(":checked")) ? true: false;
		update();
	});
	
	//The price filter functionality when it is toggled
	$(function() {
		$( '#price-range' ).slider({
			range: true,
			min: {{pricelow}},
			max: {{pricehigh}},
			step: 100,
			values: [ {{pricelow}}, {{pricehigh}} ],
			slide: function( event, ui ) {
				$( '#amount' ).val( '$' + ui.values[ 0 ] + ' - $' + ui.values[ 1 ] );
				var newhighvalue = ui.values[1].toString();
				var newlowvalue = ui.values[0].toString();
				if (newlowvalue.length > 3 ) {
					var newlowvalue = newlowvalue.splice( newlowvalue.length-3, 0, ',' );
				} 
				if (newhighvalue.length > 3) {
					var newhighvalue = newhighvalue.splice( newhighvalue.length-3, 0, ',' );
				}
				$('#lowprice span').html(newlowvalue);
				$('#highprice span').html(newhighvalue);
			},
			stop: function(event,ui ) {
				variables['pricelow'] = ui.values[ 0 ];
				variables['pricehigh'] = ui.values[ 1 ];
				update();
			}
			});
			$( '#amount' ).val( '$' + $( '#slider-range' ).slider( 'values', 0 ) +
			' - $' + $( '#slider-range' ).slider( 'values', 1 ) );
		});
	});

//Update function when a filter is called
var update = function loading() {
	$('#loadingoverlay').css('display','block');
	$.ajax({
		url: '/searchquery',
		type: 'GET',
		data: variables,
		cache:false,
		dataType: 'html',
		success: function(response){
			$('#loadingoverlay').css('display','none');
			$("#resultcontainer").empty();
			$("#resultcontainer").append(response);
			if ($('#resultcontainer').is(":empty")) {
				console.log("here");
				$("#noresults").css('display','block');
			} else {
				$("#noresults").css('display','none');
			}
			activateResultsBoxItems();
		}
	});
}


//*********************************************
//*** Helper Functions ************************
//*********************************************

//Used by the slider to convert a number back to an integer
String.prototype.splice = function( idx, rem, s ) {
    return (this.slice(0,idx) + s + this.slice(idx + Math.abs(rem)));
};
//*********************************************
//*** Unused Functions ************************
//*********************************************
	//When the show more button is pressed, load in more products
	// $('#showmorebutton').click(function() {
// 		$('#showmorebutton p').css('display','none');
// 		$('#showmorebutton img').css('display','block');
// 		$.ajax({
// 			url: '/searchquery',
// 			type: 'GET',
// 			data: variables,
// 			cache: false,
// 			dataType: 'json',
// 			success: function(response){
// 				$.each(response, function( key, pd) {
// 					generateProduct(pd['name'],pd['manufacturer'],pd['description'],pd['lowprice']);
// 					console.log("Generating more products");
// 				});
// 				$('#showmorebutton p').css('display','block');
// 				$('#showmorebutton img').css('display','none');
// 			}
// 		});
// 	});
</script>
{% endblock %}